<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilingual Memory</title>
  <style>
    :root{
      --bg1:#f9ecff; --bg2:#e8f6ff; --ink:#1f2937; --muted:#6b7280; --accent:#8b5cf6; --accent2:#14b8a6;
      --card:#ffffff; --good:#16a34a; --bad:#ef4444; --gold:#f59e0b;
    }
    html,body{height:100%;}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 700px at 10% -10%, var(--bg1), transparent),
                  radial-gradient(1200px 700px at 110% 110%, var(--bg2), transparent),
                  linear-gradient(180deg, #fff, #fafbff 60%, #f7fbff);
    }
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;}
    h1{font-size: clamp(22px, 3vw, 34px); margin:0; line-height:1.15;}
    .sub{color:var(--muted); font-size:14px}

    .controls{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .controls > *{font-size:14px}
    select, button, .toggle{
      border:1px solid #e5e7eb; background:#fff; border-radius:12px; padding:10px 12px; cursor:pointer;
      transition:.15s ease; box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    button{background:linear-gradient(180deg, #fff, #f4f7ff);}
    button:hover{transform: translateY(-1px)}
    button.primary{background:linear-gradient(180deg, #fff, #ede9fe); border-color:#ddd;}

    .stats{display:flex; gap:18px; align-items:center; flex-wrap:wrap}
    .stat{background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:10px 14px; font-feature-settings: "tnum" 1, "ss02" 1;}
    .stat b{font-variant-numeric: tabular-nums;}

    .board{margin-top:16px; display:grid; gap:12px; grid-template-columns: repeat(var(--cols,4), minmax(0,1fr));}

    .card{
      position:relative; aspect-ratio: 2/3; perspective: 1000px; user-select:none;
    }
    .card button{
      position:absolute; inset:0; border:0; padding:0; background:none; cursor:pointer;
      transform-style: preserve-3d; transition: transform .45s ease;
    }
    .face{position:absolute; inset:0; border-radius:16px; display:flex; align-items:center; justify-content:center; padding:10px; backface-visibility: hidden;}

    /* è£é¢ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ãªæŸ„ã®ã¾ã¾ï¼‰ */
    .back{
      background: repeating-linear-gradient(135deg, #f3f4f6 0 10px, #eef2ff 10px 20px);
      border:1px solid #e5e7eb;
    }
    /* è¡¨é¢ */
    .front{
      background:var(--card); border:1px solid #e5e7eb; transform: rotateY(180deg);
      display:flex; flex-direction:column; gap:8px; text-align:center;
    }
    .label{font-size: clamp(16px, 2.6vw, 24px); font-weight:700; letter-spacing:.3px}
    .lang{font-size:12px; color:var(--muted)}
    .pairhint{font-size:10px; color:#9ca3af; display:none}

    .flipped button{transform: rotateY(180deg)}
    .matched{opacity:.7; filter: saturate(.7)}

    .footer{margin:16px 0 24px; color:var(--muted); font-size:13px}

    .ribbon{display:inline-flex; align-items:center; gap:8px; background: #fff; border:1px solid #e5e7eb; padding:8px 12px; border-radius:999px}
    .ribbon .dot{width:10px; height:10px; border-radius:50%; background:var(--gold)}

    .toast{position:fixed; left:50%; bottom:24px; transform: translateX(-50%); background:#111827; color:#fff; padding:12px 16px; border-radius:12px; opacity:0; pointer-events:none; transition:.3s ease}
    .toast.show{opacity:1}

    @media (max-width: 640px){
      .board{gap:10px}
      .face{border-radius:12px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸƒ Bilingual Memory</h1>
        <div class="sub">
          JPâ†”EN ã®åŒã˜æ¦‚å¿µãƒšã‚¢ã‚’åˆã‚ã›ã¦ã­ã€‚<b>ã‚«ãƒ†ã‚´ãƒª</b>ã¨<b>æšæ•°</b>ã‚’é¸ã‚“ã§ <em>New game</em>ï¼
          ï¼ˆä¾‹ï¼š<b>light</b> ã¯ã€Œå…‰ï¼è»½ã„ã€ã§åˆ¥æ¦‚å¿µã€<b>warm</b> ã¯ã€Œæ¸©ã‹ã„ï¼æš–ã‹ã„ã€ã§ä½¿ã„åˆ†ã‘ğŸ˜‰ï¼‰
        </div>
      </div>
      <div class="controls">
        <label>Category
          <select id="category">
            <option value="daily">æ—¥å¸¸</option>
            <option value="advanced">ä¸Šç´š</option>
            <option value="extreme">ã‚¨ã‚¯ã‚¹ãƒˆãƒªãƒ¼ãƒ </option>
            <option value="nuance">æ¥µæ‚ªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ç‰¹è¨“ï¼‰</option>
            <option value="trap">å¾“æ¥ã®ãƒˆãƒ©ãƒƒãƒ—ï¼ˆæ—§ãƒ‡ãƒƒã‚­ï¼‰</option>
          </select>
        </label>
        <label>Deck
          <select id="deckSize">
            <option value="8">8 pairs (16 cards)</option>
            <option value="10" selected>10 pairs (20 cards)</option>
            <option value="12">12 pairs (24 cards)</option>
          </select>
        </label>
        <label class="toggle">
          <input type="checkbox" id="debugToggle" /> Debug hints
        </label>
        <button id="newGame" class="primary">New game</button>
      </div>
    </header>

    <section class="stats" aria-live="polite" aria-atomic="true">
      <div class="stat">â±ï¸ Time: <b id="time">0:00</b></div>
      <div class="stat">ğŸ¯ Moves: <b id="moves">0</b></div>
      <div class="stat">âœ… Matches: <b id="matches">0</b>/<b id="totalPairs">0</b></div>
      <div class="ribbon" id="status"><span class="dot"></span><span>Ready</span></div>
    </section>

    <main class="board" id="board" style="--cols:5"></main>

    <p class="footer">Debugã‚’ONã«ã™ã‚‹ã¨ã‚«ãƒ¼ãƒ‰è¡¨ã«ã€Œæ¦‚å¿µãƒ’ãƒ³ãƒˆã€ãŒå°ã•ãå‡ºã‚‹ã‚ˆï¼ˆå­¦ç¿’å‘ã‘ï¼‰ã€‚</p>
  </div>

  <div class="toast" id="toast"></div>

  <script>
  // ====== ã‚«ãƒ†ã‚´ãƒªè¾æ›¸ ======
  // ã§ãã‚‹ã ã‘ä»Šã®æ§‹é€ ã‚’ä¿ã¤ãŸã‚ã€å„ã€Œæ¦‚å¿µã€ã¯ { id, ja, en, hint? } ã«çµ±ä¸€
  // ï¼ˆç”Ÿæˆæ™‚ã« JP/EN ã®2æšã«å±•é–‹ã—ã€pair ã¯ id ã§åˆ¤å®šï¼‰
  const WORD_CATEGORIES = {
    daily: [
      { id:'friend',   ja:'å‹é”',     en:'friend' },
      { id:'work',     ja:'ä»•äº‹',     en:'work' },
      { id:'school',   ja:'å­¦æ ¡',     en:'school' },
      { id:'money',    ja:'ãŠé‡‘',     en:'money' },
      { id:'time',     ja:'æ™‚é–“',     en:'time' },
      { id:'family',   ja:'å®¶æ—',     en:'family' },
      { id:'train',    ja:'é›»è»Š',     en:'train' },
      { id:'meal',     ja:'é£Ÿäº‹',     en:'meal' },
      { id:'message',  ja:'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', en:'message' },
      { id:'vacation', ja:'ä¼‘æš‡',     en:'vacation' },
      { id:'water',    ja:'æ°´',       en:'water' },
      { id:'house',    ja:'å®¶',       en:'house' },
      { id:'phone',    ja:'é›»è©±',     en:'phone' },
      { id:'coffee',   ja:'ã‚³ãƒ¼ãƒ’ãƒ¼', en:'coffee' },
      { id:'meeting',  ja:'ä¼šè­°',     en:'meeting' },
    ],
    advanced: [
      { id:'dream',      ja:'å¤¢',     en:'dream' },
      { id:'freedom',    ja:'è‡ªç”±',   en:'freedom' },
      { id:'memory',     ja:'è¨˜æ†¶',   en:'memory' },
      { id:'justice',    ja:'æ­£ç¾©',   en:'justice' },
      { id:'emotion',    ja:'æ„Ÿæƒ…',   en:'emotion' },
      { id:'destiny',    ja:'é‹å‘½',   en:'destiny' },
      { id:'eternity',   ja:'æ°¸é ',   en:'eternity' },
      { id:'silence',    ja:'æ²ˆé»™',   en:'silence' },
      { id:'truth',      ja:'çœŸå®Ÿ',   en:'truth' },
      { id:'illusion',   ja:'å¹»',     en:'illusion' },
      { id:'chaos',      ja:'æ··æ²Œ',   en:'chaos' },
      { id:'harmony',    ja:'èª¿å’Œ',   en:'harmony' },
    ],
    extreme: [
      { id:'quantum',       ja:'é‡å­',             en:'quantum' },
      { id:'relativity',    ja:'ç›¸å¯¾æ€§ç†è«–',       en:'relativity' },
      { id:'consciousness', ja:'æ„è­˜',             en:'consciousness' },
      { id:'metaphor',      ja:'éš å–©',             en:'metaphor' },
      { id:'singularity',   ja:'ç‰¹ç•°ç‚¹',           en:'singularity' },
      { id:'entropy',       ja:'ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼',     en:'entropy' },
      { id:'neuralnet',     ja:'ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯', en:'neural network' },
      { id:'paradox',       ja:'é€†èª¬',             en:'paradox' },
      { id:'ontology',      ja:'å­˜åœ¨è«–',           en:'ontology' },
      { id:'epistemology',  ja:'èªè­˜è«–',           en:'epistemology' },
      { id:'aesthetics',    ja:'ç¾å­¦',             en:'aesthetics' },
      { id:'dialectic',     ja:'å¼è¨¼æ³•',           en:'dialectic' },
    ],
    // Akiã®â€œãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹åœ°ç„â€ï¼æ¥µæ‚ªãƒ¢ãƒ¼ãƒ‰
    nuance: [
      // æ¸©åº¦ãƒ»æ„Ÿè¦š
      { id:'warm_atataka', ja:'æš–ã‹ã„', en:'warm', hint:'æ°—æ¸©ã‚„ç©ºæ°—' },
      { id:'warm_otsukai', ja:'æ¸©ã‹ã„', en:'warm', hint:'æ°—æŒã¡ãƒ»æ–™ç†' },
      { id:'hot_atsui',    ja:'ç†±ã„',   en:'hot',  hint:'è§¦ã‚‹ã¨å±é™º' },
      { id:'cool_suzushii',ja:'æ¶¼ã—ã„', en:'cool', hint:'å¿«é©ãªå†·ãŸã•' },
      { id:'cold_tsumetai',ja:'å†·ãŸã„', en:'cold', hint:'æ¸©åº¦ï¼æ…‹åº¦' },
      { id:'cold_sameta',  ja:'å†·ã‚ãŸ', en:'cold', hint:'èˆˆå‘³ãƒ»æƒ…ç†±ãŒãªããªã‚‹' },

      // é€Ÿã•ãƒ»æ™‚é–“
      { id:'early_hayai',  ja:'æ—©ã„',   en:'early', hint:'æ™‚é–“ãŒå‰' },
      { id:'fast_hayai',   ja:'é€Ÿã„',   en:'fast',  hint:'ã‚¹ãƒ”ãƒ¼ãƒ‰' },

      // é«˜ã•ãƒ»å¤§ãã•
      { id:'high_takai',   ja:'é«˜ã„',   en:'high',      hint:'ä½ç½®ãƒ»èƒŒã®é«˜ã•' },
      { id:'exp_takai',    ja:'é«˜ã„',   en:'expensive', hint:'å€¤æ®µ' },

      // è¦‹ã‚‹
      { id:'see_miru',     ja:'è¦‹ã‚‹',   en:'see',     hint:'ä¸€èˆ¬çš„ã«ç›®ã§è¦‹ã‚‹' },
      { id:'watch_miru',   ja:'è¦³ã‚‹',   en:'watch',   hint:'æ„è­˜ã—ã¦æ³¨è¦–ã™ã‚‹' },
      { id:'examine_miru', ja:'è¨ºã‚‹',   en:'examine', hint:'åŒ»è€…ãŒä½“ã‚’è¨ºã‚‹' },

      // èã
      { id:'hear_kiku',    ja:'èã',   en:'hear',   hint:'è‡ªç„¶ã«è€³ã«å…¥ã‚‹' },
      { id:'listen_kiku',  ja:'è´ã',   en:'listen', hint:'æ„è­˜ã—ã¦è€³ã‚’å‚¾ã‘ã‚‹' },
      { id:'ask_kiku',     ja:'è¨Šã',   en:'ask',    hint:'è³ªå•ã™ã‚‹' },

      // åˆ†ã‹ã‚‹
      { id:'know_shiru',   ja:'çŸ¥ã‚‹',     en:'know',       hint:'çŸ¥è­˜ã¨ã—ã¦çŸ¥ã£ã¦ã„ã‚‹' },
      { id:'understand',   ja:'åˆ†ã‹ã‚‹',   en:'understand', hint:'ç†è§£ã™ã‚‹' },
      { id:'recognize',    ja:'åˆ†ã‹ã‚‹',   en:'recognize',  hint:'è¦‹ã¦è­˜åˆ¥ã™ã‚‹' },

      // æŒã¤
      { id:'have_motsu',   ja:'æŒã¤',       en:'have',  hint:'æ‰€æœ‰ã—ã¦ã„ã‚‹' },
      { id:'hold_motsu',   ja:'æŒã¤',       en:'hold',  hint:'æ‰‹ã«æŒã£ã¦ã„ã‚‹' },
      { id:'own_shoyuu',   ja:'æ‰€æœ‰ã™ã‚‹',   en:'own',   hint:'æ­£å¼ã«è‡ªåˆ†ã®ã‚‚ã®' },
      { id:'carry_mochi',  ja:'æŒã¡é‹ã¶',   en:'carry', hint:'é‹ã‚“ã§ã„ã‚‹é€”ä¸­' },

      // ä½œã‚‹
      { id:'make_tsukuru',   ja:'ä½œã‚‹',    en:'make',    hint:'ä½•ã‹ã‚’ä½œã‚Šå‡ºã™' },
      { id:'create_souzou',  ja:'å‰µé€ ã™ã‚‹', en:'create',  hint:'æ–°ã—ã„ã‚‚ã®ã‚’ç”Ÿã¿å‡ºã™' },
      { id:'build_tateru',   ja:'å»ºã¦ã‚‹',   en:'build',   hint:'å»ºç¯‰ãƒ»æ§‹é€ ç‰©' },
      { id:'produce_seisan', ja:'ç”Ÿç”£ã™ã‚‹', en:'produce', hint:'å¤§é‡ç”Ÿç”£' },

      // è€ƒãˆã‚‹
      { id:'think_kangae',   ja:'è€ƒãˆã‚‹',   en:'think',    hint:'æ€ã„æµ®ã‹ã¹ã‚‹' },
      { id:'consider_kouryo',ja:'è€ƒæ…®ã™ã‚‹', en:'consider', hint:'ã‚ˆãè€ƒãˆã¦åˆ¤æ–­' },
      { id:'imagine_souzou', ja:'æƒ³åƒã™ã‚‹', en:'imagine',  hint:'é ­ã®ä¸­ã§æã' },
      { id:'guess_suisoku',  ja:'æ¨æ¸¬ã™ã‚‹', en:'guess',    hint:'å½“ã¦ãšã£ã½ã†' },

      // ä½¿ã†
      { id:'use_tsukau',     ja:'ä½¿ã†',       en:'use',     hint:'ä¸€èˆ¬çš„ã«åˆ©ç”¨' },
      { id:'spend_tsukau',   ja:'ä½¿ã†',       en:'spend',   hint:'ãŠé‡‘ãƒ»æ™‚é–“ã‚’æ¶ˆè²»' },
      { id:'wear_mitsukeru', ja:'èº«ã«ã¤ã‘ã‚‹', en:'wear',    hint:'æœãƒ»ã‚¢ã‚¯ã‚»' },
      { id:'consume_shouhi', ja:'æ¶ˆè²»ã™ã‚‹',   en:'consume', hint:'è³‡æºãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼' },
    ],
    // æ—¢å­˜ã®ãƒˆãƒ©ãƒƒãƒ—ï¼ˆAkiãŒæœ€åˆã«éŠã‚“ã ã‚„ã¤ï¼‰ã‚‚é¸ã¹ã‚‹ã‚ˆã†ã«æ®‹ã™
    trap: [
      { id:'warm1',  ja:'æ¸©ã‹ã„', en:'warm' },
      { id:'warm2',  ja:'ã‚ã£ãŸã‹ã„', en:'warm' },
      { id:'light1', ja:'å…‰',     en:'light' },
      { id:'light2', ja:'è»½ã„',   en:'light' },
      { id:'see',    ja:'è¦‹ã‚‹',   en:'see' },
      { id:'watch',  ja:'è¦³ã‚‹',   en:'watch' },
      { id:'hear',   ja:'èã',   en:'hear' },
      { id:'listen', ja:'è´ã',   en:'listen' },
      { id:'fast',   ja:'é€Ÿã„',   en:'fast' },
      { id:'early',  ja:'æ—©ã„',   en:'early' },
      { id:'up',     ja:'ä¸Š',     en:'up' },
      { id:'climb',  ja:'ä¸Šã‚‹',   en:'climb' },
    ],
  };

  // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
  const $ = (q) => document.querySelector(q);
  const board = $('#board');
  const timeEl = $('#time');
  const movesEl = $('#moves');
  const matchesEl = $('#matches');
  const totalPairsEl = $('#totalPairs');
  const statusEl = $('#status');
  const deckSizeEl = $('#deckSize');
  const categoryEl = $('#category');
  const debugToggle = $('#debugToggle');
  const toastEl = $('#toast');

  let state = {
    deck: [], first: null, second: null, lock: false,
    moves: 0, matches: 0, totalPairs: 0, started: false, timer: null, secs: 0,
  };

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }
  function fmtTime(s){ const m = Math.floor(s/60); const r = s%60; return `${m}:${r.toString().padStart(2,'0')}`; }
  function setColsByCount(n){ const cols = (n===16)?4 : (n===20)?5 : (n===24)?6 : Math.ceil(Math.sqrt(n)); board.style.setProperty('--cols', cols); }
  function toast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 1400); }

  // ====== ãƒ‡ãƒƒã‚­ç”Ÿæˆï¼ˆã‚«ãƒ†ã‚´ãƒªå¯¾å¿œãƒ»ã§ãã‚‹ã ã‘ç¾è¡Œæ§‹é€ ã«å¯„ã›ã‚‹ï¼‰ ======
  function buildDeck(pairCount){
    const cat = categoryEl.value;
    const source = WORD_CATEGORIES[cat] || WORD_CATEGORIES.trap;
    const pairs = source.slice(0, pairCount); // ã‚·ãƒ³ãƒ—ãƒ«ã«å…ˆé ­ã‹ã‚‰å¿…è¦æ•°ï¼ˆå¿…è¦ãªã‚‰ã‚ã¨ã§ãƒ©ãƒ³ãƒ€ãƒ æŠ½å‡ºã«å¤‰æ›´å¯ï¼‰

    const cards = [];
    let cid = 1;
    for(const p of pairs){
      // JP
      cards.push({ cid: cid++, text: p.ja, lang: 'JP', pair: p.id, hint: p.hint || '' });
      // EN
      cards.push({ cid: cid++, text: p.en, lang: 'EN', pair: p.id, hint: p.hint || '' });
    }
    return shuffle(cards);
  }

  function renderDeck(){
    board.innerHTML = '';
    for(const card of state.deck){
      const root = document.createElement('div');
      root.className = 'card';
      root.dataset.cid = card.cid;
      root.dataset.pair = card.pair;
      root.dataset.lang = card.lang;

      const btn = document.createElement('button');
      btn.setAttribute('aria-label', 'flip card');

      const back = document.createElement('div');
      back.className = 'face back';
      back.innerHTML = '<svg aria-hidden="true" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:.3"><rect x="3" y="3" width="18" height="18" rx="3"/><path d="M7 7h10M7 12h10M7 17h6"/></svg>';

      const front = document.createElement('div');
      front.className = 'face front';
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = card.text;
      const lang = document.createElement('div');
      lang.className = 'lang';
      lang.textContent = (card.lang === 'JP' ? 'æ—¥æœ¬èª' : 'English');
      const hint = document.createElement('div');
      hint.className = 'pairhint';
      hint.textContent = card.hint ? `hint: ${card.hint}` : `concept: ${card.pair}`;
      front.appendChild(label); front.appendChild(lang); front.appendChild(hint);

      btn.appendChild(back); btn.appendChild(front);
      root.appendChild(btn);
      board.appendChild(root);

      btn.addEventListener('click', ()=> onFlip(root));
    }
  }

  // ====== ã‚¿ã‚¤ãƒãƒ¼ ======
  function startTimer(){ if(state.started) return; state.started = true; state.timer = setInterval(()=>{ state.secs++; timeEl.textContent = fmtTime(state.secs); }, 1000); }
  function stopTimer(){ if(state.timer){ clearInterval(state.timer); state.timer=null; } }

  // ====== ã‚²ãƒ¼ãƒ é€²è¡Œ ======
  function onFlip(el){
    if(state.lock) return;
    if(el.classList.contains('flipped') || el.classList.contains('matched')) return;

    startTimer();
    el.classList.add('flipped');

    if(!state.first){ state.first = el; setStatus("Thinkingâ€¦"); return; }
    state.second = el; state.lock = true; state.moves++; movesEl.textContent = state.moves;

    const ok = isMatch(state.first, state.second);
    if(ok){
      setTimeout(()=>{
        state.first.classList.add('matched');
        state.second.classList.add('matched');
        state.first = state.second = null; state.lock = false; state.matches++; matchesEl.textContent = state.matches;
        setStatus("Nice! It's a match âœ¨");
        if(state.matches === state.totalPairs){
          stopTimer(); setStatus("All matched! GG ğŸ‰"); toast(`Finished in ${fmtTime(state.secs)} with ${state.moves} moves`);
        }
      }, 350);
    } else {
      setTimeout(()=>{
        state.first.classList.remove('flipped');
        state.second.classList.remove('flipped');
        state.first = state.second = null; state.lock = false; setStatus("Try again ğŸ˜");
      }, 700);
    }
  }

  function isMatch(a,b){
    const pa = a.dataset.pair, pb = b.dataset.pair;
    const la = a.dataset.lang, lb = b.dataset.lang;
    return pa === pb && la !== lb; // åŒã˜æ¦‚å¿µID & è¨€èªãŒé€†
  }

  function setStatus(msg){ statusEl.querySelector('span:last-child').textContent = msg; }

  function newGame(){
    stopTimer();
    state = { deck: [], first:null, second:null, lock:false, moves:0, matches:0, totalPairs:0, started:false, timer:null, secs:0 };
    timeEl.textContent = '0:00'; movesEl.textContent = '0'; matchesEl.textContent = '0';

    const pairsWanted = parseInt(deckSizeEl.value,10);
    state.totalPairs = Math.min(pairsWanted, (WORD_CATEGORIES[categoryEl.value] || WORD_CATEGORIES.trap).length);
    totalPairsEl.textContent = state.totalPairs;

    state.deck = buildDeck(state.totalPairs);
    setColsByCount(state.deck.length);
    renderDeck();
    setStatus('Ready');

    // debug hints
    document.querySelectorAll('.pairhint').forEach(el=>{
      el.style.display = debugToggle.checked ? 'block' : 'none';
    });
  }

  // events
  $('#newGame').addEventListener('click', newGame);
  deckSizeEl.addEventListener('change', newGame);
  categoryEl.addEventListener('change', newGame);
  debugToggle.addEventListener('change', ()=>{
    document.querySelectorAll('.pairhint').forEach(el=>{
      el.style.display = debugToggle.checked ? 'block' : 'none';
    });
  });

  // start
  newGame();
  </script>
</body>
</html>
